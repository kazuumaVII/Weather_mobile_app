"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = configureStore;

var _redux = require("redux");

var _localforage = _interopRequireDefault(require("localforage"));

var _reduxPersist = require("redux-persist");

var _api = require("../middlewares/api");

var _exportState = require("../middlewares/exportState");

var _reducers = require("../reducers");

var persistConfig = {
  key: 'redux-devtools',
  blacklist: ['instances', 'socket'],
  storage: _localforage.default
};
var persistedReducer = (0, _reduxPersist.persistReducer)(persistConfig, _reducers.rootReducer);

function configureStore(callback) {
  var composeEnhancers = _redux.compose;

  if (process.env.NODE_ENV !== 'production') {
    if (window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) {
      composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;
    }

    if (module.hot) {
      // Enable Webpack hot module replacement for reducers
      module.hot.accept('../reducers', function () {
        // eslint-disable-next-line @typescript-eslint/no-var-requires
        var nextReducer = require('../reducers'); // eslint-disable-line global-require


        store.replaceReducer(nextReducer);
      });
    }
  }

  var store = (0, _redux.createStore)(persistedReducer, composeEnhancers((0, _redux.applyMiddleware)(_exportState.exportStateMiddleware, _api.api)));
  var persistor = (0, _reduxPersist.persistStore)(store, null, function () {
    callback(store);
  });
  return {
    store: store,
    persistor: persistor
  };
}